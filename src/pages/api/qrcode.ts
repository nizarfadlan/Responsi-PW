import { type Options, QRCodeCanvas } from "@loskir/styled-qr-code-node";
import type { NextApiRequest, NextApiResponse } from "next";

const options: Partial<Options> = {
  image: "data:image/png;base64,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",
  dotsOptions: {
    type: "extra-rounded",
    color: "#16181A",
  },
  margin: 13,
  backgroundOptions: {
    color: "#fff",
  },
  cornersSquareOptions: { type: "extra-rounded", color: "#16181A" },
  cornersDotOptions: {
    color: "#16181A",
  },
  imageOptions: {
    crossOrigin: "anonymous",
    hideBackgroundDots: true,
    imageSize: 0.35,
  },
  qrOptions: {
    typeNumber: 7,
    errorCorrectionLevel: "Q",
  }
};

type Data = {
  data: string;
  width?: number;
  height?: number;
}

export type ResponseData = {
  status: string;
  data?: string;
  message?: string;
}

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse<ResponseData>
) {
  if (req.method === "POST") {
    try {
      const { data, height, width } = req.body as Data;

      if (!data) {
        return res.status(500).json({ status: "failed", message: "Value QR required" });
      }


      const qrCode = new QRCodeCanvas({
        data,
        height: height || 300,
        width: width || 300,
        ...options,
      });

      const file = await qrCode.toDataUrl("png");
      return res.status(200).json({ status: "success", data: file });
    } catch (error) {
      return res.status(500).json({ status: "failed", message: "Failed to generate QR code" });
    }
  } else {
    return res.status(400).json({ status: "failed", message: "Invalid request" });
  }
}
